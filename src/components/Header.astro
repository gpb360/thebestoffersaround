---
import { navigationData } from '../data/navigation';
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-off-black/95 backdrop-blur-sm border-b border-gold/20">
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->
      <a href="/" class="flex-shrink-0">
        <span class="text-xl sm:text-2xl font-bold text-gold">The Best Offers Around</span>
      </a>

      <!-- Desktop Navigation with Dropdowns -->
      <div class="hidden lg:block">
        <div class="ml-8 xl:ml-10 flex items-baseline space-x-1 xl:space-x-2">
          {navigationData.map(item => (
            <div class="relative group">
              {item.children ? (
                // Dropdown menu
                <>
                  <button class="px-4 py-2 rounded-md text-sm font-medium transition-colors hover:text-gold hover:bg-dark-gray flex items-center gap-1.5">
                    {item.name}
                    <svg class="w-3.5 h-3.5 transition-transform group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </button>
                  <div class="absolute left-0 mt-2 w-64 bg-dark-gray border border-gold/20 rounded-md shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                    <div class="py-2">
                      {item.children.map(child => (
                        <a
                          href={child.href}
                          class:underline={currentPath === child.href}
                          class:text-gold={currentPath === child.href}
                          class="block px-4 py-2.5 text-sm hover:bg-off-black transition-colors first:rounded-t-md last:rounded-b-md"
                        >
                          <div class="font-medium">{child.name}</div>
                          {child.description && (
                            <div class="text-xs text-gray-400 mt-0.5">{child.description}</div>
                          )}
                        </a>
                      ))}
                    </div>
                  </div>
                </>
              ) : (
                // Regular link
                <a
                  href={item.href}
                  class:underline={currentPath === item.href}
                  class:text-gold={currentPath === item.href}
                  class="px-4 py-2 rounded-md text-sm font-medium transition-colors hover:text-gold hover:bg-dark-gray"
                >
                  {item.name}
                </a>
              )}
            </div>
          ))}
        </div>
      </div>

      <!-- Mobile menu button -->
      <div class="lg:hidden">
        <button
          type="button"
          id="mobile-menu-button"
          class="inline-flex items-center justify-center p-2 rounded-md text-off-white hover:text-gold hover:bg-dark-gray focus:outline-none focus:ring-2 focus:ring-gold"
          aria-expanded="false"
          aria-controls="mobile-menu"
        >
          <span class="sr-only">Open main menu</span>
          <svg class="block h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile menu with accordion dropdowns -->
  <div class="lg:hidden hidden" id="mobile-menu">
    <div class="px-3 pt-2 pb-4 space-y-1 sm:px-4 bg-dark-gray">
      {navigationData.map(item => (
        <div>
          {item.children ? (
            // Mobile accordion
            <>
              <button class="mobile-dropdown-toggle w-full flex items-center justify-between px-3 py-3 rounded-md text-base font-medium hover:text-gold hover:bg-off-black transition-colors">
                <span>{item.name}</span>
                <svg class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="mobile-dropdown-menu hidden pl-4 space-y-0.5 mt-1">
                {item.children.map(child => (
                  <a
                    href={child.href}
                    class:underline={currentPath === child.href}
                    class:text-gold={currentPath === child.href}
                    class="block px-3 py-2.5 rounded-md text-sm hover:bg-off-black transition-colors"
                  >
                    {child.name}
                  </a>
                ))}
              </div>
            </>
          ) : (
            // Regular link
            <a
              href={item.href}
              class:underline={currentPath === item.href}
              class:text-gold={currentPath === item.href}
              class="block px-3 py-3 rounded-md text-base font-medium hover:text-gold hover:bg-off-black transition-colors"
            >
              {item.name}
            </a>
          )}
        </div>
      ))}
    </div>
  </div>

  <!-- Mobile menu script -->
  <script is:inline>
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    mobileMenuButton?.addEventListener('click', () => {
      const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
      mobileMenuButton.setAttribute('aria-expanded', (!isExpanded).toString());
      mobileMenu?.classList.toggle('hidden');
    });

    // Mobile dropdown toggles
    const dropdownToggles = document.querySelectorAll('.mobile-dropdown-toggle');
    dropdownToggles.forEach(toggle => {
      toggle.addEventListener('click', (e) => {
        const menu = toggle.nextElementSibling;
        const icon = toggle.querySelector('svg');
        menu.classList.toggle('hidden');
        icon.classList.toggle('rotate-180');
      });
    });
  </script>
</header>
