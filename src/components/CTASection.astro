---
/**
 * CTASection Component
 * High-converting call-to-action sections with tracking
 */

import { trackAffiliateClick } from '../lib/posthog';

interface Props {
  productName: string;
  productSlug: string;
  affiliateLink: string;
  title?: string;
  description?: string;
  buttonText?: string;
  disclaimer?: string;
  variant?: 'primary' | 'secondary' | 'comparison';
  location?: string; // For tracking: where CTA is placed
  articleSlug?: string; // For tracking
  articleCategory?: string; // For tracking
}

const {
  productName,
  productSlug,
  affiliateLink,
  title = 'Ready to Take Action?',
  description,
  buttonText = 'Visit Official Site →',
  disclaimer,
  variant = 'primary',
  location = 'unknown',
  articleSlug,
  articleCategory,
} = Astro.props;

const styles = {
  primary: 'bg-gradient-to-r from-gold/20 to-amber-600/20 border-gold/50',
  secondary: 'bg-gradient-to-r from-blue-600/20 to-indigo-600/20 border-blue-500/50',
  comparison: 'bg-gradient-to-r from-purple-600/20 to-pink-600/20 border-purple-500/50',
};
---

<div class={`cta-section relative overflow-hidden ${styles[variant]} border-2 rounded-2xl p-8 sm:p-12 my-12`} data-cta-location={location}>
  <!-- Animated background gradient -->
  <div class="absolute inset-0 bg-gradient-to-r from-gold/10 via-amber-500/10 to-gold/10 animate-pulse"></div>

  <!-- Decorative corner elements -->
  <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-gold/20 to-transparent rounded-bl-full"></div>
  <div class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-gold/20 to-transparent rounded-tr-full"></div>

  <div class="relative text-center">
    <!-- Icon -->
    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-gold to-amber-600 rounded-2xl shadow-lg shadow-gold/30 mb-6">
      <svg class="w-8 h-8 text-off-black" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
      </svg>
    </div>

    <h3 class="text-3xl sm:text-4xl font-extrabold text-off-white mb-4">
      {title}
    </h3>

    {description && (
      <p class="text-gray-300 text-xl mb-8 max-w-2xl mx-auto leading-relaxed">
        {description}
      </p>
    )}

    <a
      href={affiliateLink}
      target="_blank"
      rel="noopener sponsored noreferrer"
      class="cta-button group inline-flex items-center gap-3 bg-gradient-to-r from-gold to-amber-600 hover:from-amber-400 hover:to-gold text-off-black font-bold text-lg px-10 py-5 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-2xl shadow-gold/30"
      onClick={`trackCTA('${productSlug}', '${location}', '${productName}')`}
    >
      <span>{buttonText}</span>
      <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
      </svg>
    </a>

    {disclaimer && (
      <p class="text-gray-400 text-sm mt-6 max-w-xl mx-auto">
        {disclaimer}
      </p>
    )}

    <div class="mt-6 flex items-center justify-center gap-2 text-gray-500 text-xs">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
      </svg>
      <span>Affiliate Disclosure: We may earn a commission if you purchase through our link.</span>
    </div>
  </div>
</div>

<script>
  import { trackAffiliateClick } from '../lib/posthog';

  // Make tracking function available globally for onClick handlers
  (window as any).trackCTA = (
    productSlug: string,
    location: string,
    productName: string
  ) => {
    trackAffiliateClick({
      productId: productSlug,
      productName,
      ctaLocation: location,
      articleSlug: (window as any).currentArticleSlug,
      articleCategory: (window as any).currentArticleCategory,
      buttonText: 'Visit Official Site →',
    });
  };
</script>

<style>
  .cta-section {
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
  }

  .cta-button:hover {
    box-shadow: 0 8px 25px rgba(234, 179, 8, 0.4);
  }

  @media (max-width: 640px) {
    .cta-section {
      padding: 1.5rem;
    }

    .cta-button {
      width: 100%;
    }
  }
</style>
